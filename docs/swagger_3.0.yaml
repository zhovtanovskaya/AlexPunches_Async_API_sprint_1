openapi: 3.0.3
info:
  title: Auth. Sprint 6.
  description: |-
    ## TODO
      - –ø—Ä–æ–¥—É–º–∞—Ç—å –∏ —Ä–µ—à–∏—Ç—å –∫–∞–∫–∏–º –±—É–¥–µ—Ç —Ä–æ—É—Ç–∏–Ω–≥
      - –¥–æ–±–∞–≤–∏—Ç—å –†–æ–ª–∏
      - –≥–¥–µ-—Ç–æ —Ç—É—Ç –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ø–µ—Ä–º–∏—à–µ–Ω—ã
    ### –í–æ–ø—Ä–æ—Å–∏–∫–∏:
      - –Ω–∞–≤–µ—Ä–µ–Ω–æ, –Ω–µ –Ω—É–∂–Ω—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ `login` –∏ `email` –¥–ª—è —é–∑–µ—Ä–∞. (–ù–µ –ø–æ–º–Ω—é –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—Ç–∞—â–∏–ª login, –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–∫—É–¥–∞-—Ç–æ –∏–∑ —Ç–µ–æ—Ä–∏–∏.)  
      
    --  
    _–ó–´ ü§ï_  
    _–∫–∞–∫ –∂–µ –±—ã–ª–æ —Ö–æ—Ä–æ—à–æ —Å [–§–∞—Å—Ç–∞–ø–∏](https://fastapi.tiangolo.com/features/#automatic-docs) –∏ —Å–æ —Å–≤–∞–≥–µ—Ä–æ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º_
  version: 0.1.0
servers:
  - url: http://127.0.0.1:5000
  - url: http://127.0.0.1
tags:
  - name: auth
    description: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
  - name: user
    description: –î–µ–π—Å—Ç–≤–∏—è –Ω–∞–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
  - name: role
    description: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–º —Ä–æ–ª–µ–π

paths:
  /auth/v1/signup:
    post:
      tags:
        - auth
      summary: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞, –∞–¥–º–∏–Ω–∞ –∏–ª–∏ –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
      description: ""
      parameters:
        - name: email
          in: query
          description: –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞.
          required: true
          schema:
            type: string
        - name: password
          in: query
          description: –ü–∞—Ä–æ–ª—å.
          required: true
          schema:
            type: string
      responses:
        "200":
          description: "OK"

  /auth/v1/singin:
    get: 
      tags:
        - auth
      summary: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
      description: ''
      operationId: loginUser
      parameters:
        - name: email
          in: query
          description: –≠–ª–µ–∫—Ç—Ä–æ–ø–æ—á—Ç–∞
          required: false
          schema:
            type: string
        - name: password
          in: query
          description: –ü–∞—Ä–æ–ª—å
          required: false
          schema:
            type: string
      responses:
        '200':
          description: successful operation
          headers:
            X-Success-Token:
              description: JWT
              schema:
                type: string
            X-Refresh-Token:
              description: –û–±—ã—á–Ω—ã–π UUID
              schema:
                type: string
          content:
            application/json:
              schema:
                type: string
        '400':
          description: Invalid username/password supplied

  /auth/v1/signout:
    post:
      tags:
        - auth
      summary: –í—ã—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
      description: ''
      operationId: logoutUser
      parameters: []
      responses:
        default:
          description: successful operation

  /auth/v1/refresh:
    post:
      tags:
        - auth
      summary: –û–±–Ω–æ–≤–∏—Ç—å refresh-—Ç–æ–∫–µ–Ω.


  /auth/v1/users:
    get:
      tags:
        - user
      summary: –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
      operationId: getAllUsers
      parameters:
        - name: page
          in: query
          description: –ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
          schema:
            type: string
            default: 1
        - name: per_page
          in: query
          description: –ö–æ–ª-–≤–æ —é–∑–µ—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
          schema:
            type: string
            default: 20
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginationResponseUsers'

  /auth/v1/users/{user_id}/:
    get:
      tags:
        - user
      summary: –ü–æ–ª—É—á–∏—Ç—å –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
      operationId: getUserById
      parameters:
        - name: user_id
          in: path
          description: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          required: true
          schema:
            type: string
            format: uuid
            title: uuid
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserScheme'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseMessage'
    patch:
      tags:
        - user
      summary: –ò–∑–º–µ–Ω–∏—Ç—å –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
      description: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å username, email –∏–ª–∏ –¥—Ä—É–≥–∏–µ —Å–≤–µ–¥–µ–Ω—å—è.
      operationId: EditUser
      requestBody:
        description: –ï—Å–ª–∏ –ø–æ–ª—è –Ω–µ—Ç, –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è (PATCH)
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreateScheme'
        required: true
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserScheme'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseMessage'

  /auth/v1/users/{user_id}/singins/:
    get:
      tags:
        - user
      summary: "–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Ö–æ–¥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–∏—Å—Ç–µ–º—É."
      description: "–ò—Å—Ç–æ—Ä–∏—è –≤—Ö–æ–¥–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–∏—Å—Ç–µ–º—É."
      parameters: []
      responses:
        "200":
          description: "–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –≤—Ö–æ–¥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."
        "404":
          description: "–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ç–∞–∫–∏–º user_id."

  /auth/v1/users/{user_id}/roles/:
    get:
      tags:
        - user
      summary: –ü–æ–ª—É—á–∏—Ç—å —Ä–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    post:
      tags:
        - user
      summary: –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
      responses:
        201:
          description: –†–æ–ª—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

  /auth/v1/users/{user_id}/roles/{role_id}:
    delete:
      tags:
        - user
      summary: –û—Ç–æ–±—Ä–∞—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–æ–ª—å.


  /auth/v1/roles:
    get:
      summary: –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ä–æ–ª–∏.
      tags:
        - role
      responses:
        
    post:
      summary: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ä–æ–ª—å.
      tags:
        - role
      responses:

  /auth/v1/roles/{role_id}:
    patch:
      tags:
        - role
      summary: –ò–∑–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ä–æ–ª—å.
      responses:
    delete:
      tags:
        - role
      summary: –£–¥–∞–ª–∏—Ç—å —Ä–æ–ª—å.
      responses:


components:
  schemas:
    UserScheme:
      required: 
        - id
        - email
      type: object
      properties: 
        id:
          type: string
          title: uuid
          format: uuid
        email:
          type: string
        login:
          type: string
        is_superuser:
          type: boolean
        password:
          type: string
        roles:
          type: array
          items: 
            $ref: '#/components/schemas/RoleScheme'
    UserCreateScheme:
      required:
        - email
        - name
      type: object
      properties: 
        email:
          type: string
        login:
          type: string
        is_superuser:
          type: boolean
        password:
          type: string
    UserEditScheme:
      required:
        - email
        - name
      type: object
      properties: 
        email:
          type: string
        login:
          type: string
        is_superuser:
          type: boolean
        password:
          type: string
        roles:
          type: array
    RoleScheme:
      required:
        - id
        - name
      type: object
      properties: 
        id:
          type: integer
        name:
          type: string
        description:
          type: string
    RoleEdit:
      required:
        - name
      type: object
      properties: 
        name:
          type: string
        description:
          type: string
    PaginationResponseUsers:
      required:
      type: object
      properties:
        total:
          type: integer
        page:
          type: integer
          example: 1
        pages:
          type: integer
          example: 1
        results:
          type: array
          xml:
            name: addresses
            wrapped: true
          items:
            $ref: '#/components/schemas/UserScheme'
    BaseMessage:
      type: object
      properties:
        message:
          type: string

  requestBodies:
    UserEdit:
      description: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/UserEditScheme'
    UserCreate:
      description: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/UserCreateScheme'

  securitySchemes:
    basicAuth:
      type: http
      scheme: basic
    access-token:
      type: apiKey
      name: access_token
      in: header
    refresh-token:
      type: apiKey
      name: refresh_token
      in: header